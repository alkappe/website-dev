---
layout: default
---
<div class="cover flexbox-container" id="myContainer">
  <div id="loading">
    <h3>Loading</h3><!-- TODO: replace this a cool spinner! -->
  </div>
  <div class="title">
    {% include icon-logo.html width="6em" %}
    <ul>
      <li class="item-title"></li>
      <li class="item-description"></li>
      <li class="item-level"><i>livello minimo</i></li>
    </ul>
    <ul>
      <li><a href="#"><i class="fa fa-th" aria-hidden="true"></i></a></li>
      <li><a href="#" id="jsRefresh"><i class="fa fa-refresh" aria-hidden="true"></i></a></li>
      <li><a href="#"><i class="fa fa-code" aria-hidden="true"></i></a></li>
    </ul>
  </div>
</div>

<div class="container">
  <div class="row fullHeight">
    <div class="col-xs-12">
      <h5>News</h5>
    </div>
    <!-- Show post with category "News" -->
    {% for post in site.categories.news limit:3 %}
     <div class="col-xs-12 col-sm-4">
       <h2><a class="post-link" href="{{ post.url | prepend: site.baseurl }}">{{ post.title }}</a></h2>
       {{ post.excerpt }}
     </div>
    {% endfor %}
  </div><!--/row-->
  <div class="row fullHeight">
    <div class="col-xs-12">
      <h5>Eventi</h5>
    </div>
  </div>
</div><!--/.container-->

<script>
/*
 * This script allows us to load new content dinamically every page load
 * It loads the data from homepage.json.
 * It currently works only with P5.js script.
 *
 * Made by Federico Pepe and edited by GoToLoop
 * https://forum.Processing.org/two/discussion/19725/browser-one-click-behind-when-loading-different-p5-sketches-on-click#Item_4
*/
"use strict";

$(document).ready(() => {
  const $loading = $('#loading'),
        $title = $('.item-title'),
        $descript = $('.item-description'),
        actions = () => (pickAnotherItem(), loadScripts()),
        intRandom = (n = 2) => n * Math.random() | 0;

  let json, item, idx, scripts;

  // Load the content dinamically

  $.getJSON('{{ site.url }}/homepage.json', data => {
    if (!data.length)  return $title.html('Error: the JSON array is empty');

    $.ajaxSetup({ cache: true });
    window.mocha || (window.mocha = 'Hack to stop global auto run for p5.js');

    json = data, actions();
    $('#jsRefresh').click(actions);
  })
   .fail(() => $title.html('Error: unable to load JSON'));

  function pickAnotherItem() {
    if (json.length === 1)  return item = json[1];
    for (var rnd; (rnd = intRandom(json.length)) === idx; );
    return item = json[idx = rnd];
  }

  function loadScripts() {
    $loading.show();
    p5RemoveHack();

    scripts = [...item.includes, item.href];
    scripts.length && loadOrdered();
  }

  function loadOrdered() {
    $.getScript(scripts.shift(), scripts.length && loadOrdered || sketchLoaded);
  }

  function sketchLoaded() {
    $loading.hide('slow');
    $title.html(item.title + ' | ' + item.author);
    $descript.html(item.description);

    window.p5 && (window.setup || window.draw) && new p5;
  }

  function p5RemoveHack() {
    if (window.p5 && p5.instance) {
      p5.instance.remove();
      p5.instance = window.setup = window.draw = null;
    } else {
      const canv = document.querySelector('canvas');
      canv && canv.remove();
    }
  }
});
</script>
